<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('../partials/head'); %>
</head>
<body>

<header>
  <%- include('../partials/header'); %>
</header>

<main>
  <div class="grid-container" style="grid-template-columns: 50% 50%;">
    <%- include('../partials/card-gallery-table-filter'); %>
      <% if (locals.aggregated === undefined) { %>
        <div class="grid-item" style="grid-column: 1 / span 2">
          <!-- format card gallery based on query parameter "as" -->
          <%- include('../partials/card-gallery-' + locals.query.as); %>
        </div>
      <% } else { %>
        <div class="grid-item" style="grid-column: 1 / span 2">
          <%- include('../partials/card-gallery-images-sorted'); %>
        </div>
      <% } %>
  </div>
</main>

<script>
  const blurredImageDivs = document.querySelectorAll(".blurred-img");

  function loaded(event) {
    event.target.parentNode.classList.add("loaded");
  }

  for (bImgDiv of blurredImageDivs) {
    const img = bImgDiv.querySelector("img");

    if (img.complete) {
      loaded();
    } else {
      img.addEventListener("load", loaded);
    }
  }
</script>

<footer>
  <%- include('../partials/footer'); %>
</footer>

</body>
<%- include('../partials/postprocessing'); %>
</html>